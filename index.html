<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bill Entry</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f8e6f4; margin:20px; }
    h2 { text-align:center; }
    .config, .form, .search { margin:10px 0; text-align:center; }
    input, select, button { padding:6px; margin:4px; }
    table { width:100%; border-collapse:collapse; margin-top:20px; background:white; }
    th, td { border:1px solid #ddd; padding:8px; text-align:center; }
    th { background:#f5cce0; }
    .btn { padding:4px 10px; background:#e91e63; color:white; border:none; cursor:pointer; border-radius:4px; }
    .btn:hover { background:#c2185b; }
    .deleteBtn { background:#d32f2f; }
    .deleteBtn:hover { background:#9a0007; }
    .complete { color:green; font-weight:bold; }
    .pending { color:red; font-weight:bold; }
  </style>
</head>
<body>

  <h2>Bill Entry</h2>

  <!-- Configure Years and Trolley Types -->
  <div class="config">
    <strong>‚öô Configure Years and Trolley Types</strong><br>
    <input type="number" id="configYear" placeholder="Enter Year (e.g. 2025)" min="2024" max="2030">
    <select id="configTrolley">
      <option value="all">All Trolleys</option>
      <option value="2 wheel">2 wheel</option>
      <option value="4 wheel">4 wheel</option>
      <option value="4 wheel hyd">4 wheel hyd</option>
      <option value="4 wheel y-26">4 wheel y-26</option>
      <option value="2 wheel y-26">2 wheel y-26</option>
      <option value="4 wheel hyd y-26">4 wheel hyd y-26</option>
    </select>
    <button class="btn" onclick="applyConfig()">Apply</button>
  </div>

  <!-- Search Box -->
  <div class="search">
    üîç <input type="text" id="searchBox" placeholder="Search by Name, Village, Trolley, or Bill No" onkeyup="renderEntries()">
  </div>

  <!-- Entry Form -->
  <div class="form">
    <input type="text" id="personName" placeholder="Person Name">
    <input type="text" id="village" placeholder="Village">
    <select id="trolley">
      <option value="2 wheel">2 wheel</option>
      <option value="4 wheel">4 wheel</option>
      <option value="4 wheel hyd">4 wheel hyd</option>
      <option value="4 wheel y-26">4 wheel y-26</option>
      <option value="2 wheel y-26">2 wheel y-26</option>
      <option value="4 wheel hyd y-26">4 wheel hyd y-26</option>
    </select>
    <select id="colour">
      <option value="F Red">F Red</option>
      <option value="O Blue">O Blue</option>
      <option value="M Green">M Green</option>
      <option value="Deep Orange">Deep Orange</option>
    </select>
    <input type="text" id="billNo" placeholder="Bill Number">
    <input type="date" id="billDate">
    <button class="btn" onclick="addEntry()" id="addBtn">Add Entry</button>
    <button class="btn" onclick="updateEntry()" id="updateBtn" style="display:none;">Update Entry</button>
  </div>

  <!-- Entries Table -->
  <table id="entriesTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Village</th>
        <th>Trolley</th>
        <th>Colour</th>
        <th>Bill No.</th>
        <th>Date</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Summary Table -->
  <h3 style="text-align:center;">Orders Summary by Year and Trolley Type</h3>
  <table id="summaryTable">
    <thead>
      <tr>
        <th>Trolley / Year</th>
        <th id="yearPending"></th>
        <th id="yearCompleted"></th>
        <th id="yearTotal"></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
  let entries = [];
  let configuredYear = new Date().getFullYear();
  let configuredTrolley = "all";
  let editIndex = -1;

  // Auto-fill today's date
  window.onload = function() {
    let today = new Date().toISOString().split('T')[0];
    document.getElementById("billDate").value = today;
  };

  function applyConfig() {
    configuredYear = document.getElementById("configYear").value || new Date().getFullYear();
    configuredTrolley = document.getElementById("configTrolley").value;
    updateSummaryTable();
  }

  function addEntry() {
    let entry = {
      name: document.getElementById("personName").value,
      village: document.getElementById("village").value,
      trolley: document.getElementById("trolley").value,
      colour: document.getElementById("colour").value,
      billNo: document.getElementById("billNo").value,
      date: document.getElementById("billDate").value,
      status: "Pending",
      year: new Date(document.getElementById("billDate").value).getFullYear()
    };
    entries.push(entry);
    clearForm();
    renderEntries();
    updateSummaryTable();
  }

  function editEntry(index) {
    editIndex = index;
    let e = entries[index];
    document.getElementById("personName").value = e.name;
    document.getElementById("village").value = e.village;
    document.getElementById("trolley").value = e.trolley;
    document.getElementById("colour").value = e.colour;
    document.getElementById("billNo").value = e.billNo;
    document.getElementById("billDate").value = e.date;

    document.getElementById("addBtn").style.display = "none";
    document.getElementById("updateBtn").style.display = "inline-block";
  }

  function updateEntry() {
    let e = entries[editIndex];
    e.name = document.getElementById("personName").value;
    e.village = document.getElementById("village").value;
    e.trolley = document.getElementById("trolley").value;
    e.colour = document.getElementById("colour").value;
    e.billNo = document.getElementById("billNo").value;
    e.date = document.getElementById("billDate").value;
    e.year = new Date(document.getElementById("billDate").value).getFullYear();

    clearForm();
    document.getElementById("addBtn").style.display = "inline-block";
    document.getElementById("updateBtn").style.display = "none";

    renderEntries();
    updateSummaryTable();
  }

  function deleteEntry(index) {
    if (confirm("Are you sure you want to delete this entry?")) {
      entries.splice(index, 1);
      renderEntries();
      updateSummaryTable();
    }
  }

  function clearForm() {
    document.getElementById("personName").value = "";
    document.getElementById("village").value = "";
    document.getElementById("billNo").value = "";
    document.getElementById("billDate").value = new Date().toISOString().split('T')[0];
  }

  function renderEntries() {
    let tbody = document.querySelector("#entriesTable tbody");
    tbody.innerHTML = "";
    let searchText = document.getElementById("searchBox").value.toLowerCase();

    entries.forEach((e, index) => {
      if (
        e.name.toLowerCase().includes(searchText) ||
        e.village.toLowerCase().includes(searchText) ||
        e.trolley.toLowerCase().includes(searchText) ||
        e.billNo.toLowerCase().includes(searchText)
      ) {
        let row = `<tr>
          <td>${e.name}</td>
          <td>${e.village}</td>
          <td>${e.trolley}</td>
          <td>${e.colour}</td>
          <td>${e.billNo}</td>
          <td>${e.date}</td>
          <td>
            ${e.status === "Completed" 
              ? '<span class="complete">Completed ‚úî</span><br><button class="btn" onclick="toggleStatus('+index+')">Mark Pending</button>' 
              : '<span class="pending">Pending ‚úñ</span><br><button class="btn" onclick="toggleStatus('+index+')">Mark Completed</button>'}
          </td>
          <td>
            <button class="btn" onclick="editEntry(${index})">‚úè Edit</button>
            <button class="btn deleteBtn" onclick="deleteEntry(${index})">üóë Delete</button>
          </td>
        </tr>`;
        tbody.innerHTML += row;
      }
    });
  }

  function toggleStatus(i) {
    entries[i].status = (entries[i].status === "Completed") ? "Pending" : "Completed";
    renderEntries();
    updateSummaryTable();
  }

  function updateSummaryTable() {
    let tbody = document.querySelector("#summaryTable tbody");
    tbody.innerHTML = "";
    let summary = {};

    entries.forEach(e => {
      if (e.year == configuredYear) {
        if (configuredTrolley === "all" || e.trolley === configuredTrolley) {
          if (!summary[e.trolley]) summary[e.trolley] = {pending:0, completed:0};
          if (e.status === "Completed") summary[e.trolley].completed++;
          else summary[e.trolley].pending++;
        }
      }
    });

    document.getElementById("yearPending").innerText = configuredYear + " Pending";
    document.getElementById("yearCompleted").innerText = configuredYear + " Completed";
    document.getElementById("yearTotal").innerText = configuredYear + " Total";

    if (configuredTrolley === "all") {
      let totalPending = 0, totalCompleted = 0;
      for (let t in summary) {
        totalPending += summary[t].pending;
        totalCompleted += summary[t].completed;
      }
      let row = `<tr>
        <td>All Trolleys</td>
        <td>${totalPending}</td>
        <td>${totalCompleted}</td>
        <td>${totalPending + totalCompleted}</td>
      </tr>`;
      tbody.innerHTML += row;
    } else {
      for (let trolley in summary) {
        let s = summary[trolley];
        let row = `<tr>
          <td>${trolley}</td>
          <td>${s.pending}</td>
          <td>${s.completed}</td>
          <td>${s.pending + s.completed}</td>
        </tr>`;
        tbody.innerHTML += row;
      }
    }
  }
</script>

</body>
</html>
